module.exports=function(a){function b(a){function b(b){var d=K[K.length-1];c(b,d);var e,f=j(b);f!==!1&&b===f.location&&(b=w(f)),K.push(b);try{e=a(b)}finally{K.pop()}return e}function c(a,b){var c=j(b),f=j(a),g=!1;if(c===!1?e(a)||(g="Access to package internal files from outside of package"):d(a,c)||(g=f===!1?"Access to out-of-package files from inside packages":"Cross-package access"),g)throw g+=' is denied!\nAttempt to access "'+a+'" from "'+b+'"',new Error(g);return!0}function d(a,b){var c=j(a);return c===!1?q(a,(t(b)?O.findFarthestParent(b):b).external):c===b||(r(b,c,!0)||s(b,c))&&(u(a,c)||v("public",a,c))||r(c,b,!J.allowRemoteProtected)&&!u(a,b)&&v("protected",a,c)}function e(a){var b=j(a);return b===!1?!0:!t(b)&&(u(a,b)||v("public",a,b))}function f(a,b){var c,d;a=a.constructor!==Array?[a]:a.slice();for(var e=0;e<a.length;){d=a[e],c=y(d)?d:{location:d},b&&g(c,b);var i=!!c.external;C(c,J.packageDefaults),!i&&J.packageDefaults.external&&b&&delete c.external;var j=c.location;c.location=p(b,c),n(c.location)?(h(c,b),a.splice(e,1)):(c.location=j,a[e]=c,++e),c.packages&&(c.packages=f(c.packages,c),0===c.packages.length&&(c.packages=!1))}return a}function g(a,b){var c={};for(var d in b.inheritable)b.inheritable[d]===!0&&(c[d]=b[d]);return C(a,c),a}function h(a,b){var c=z(m(b));i(a,c),O.insertPackage(a);var d=w(a);return G[a.location]=a,F[a.location]=a.location,F[d]=a.location,I[d]=a.location,I[a.location]=c,a}function i(a,b){var c=b.length>0;if(c&&a.external)throw new Error('Nested packages can\'t have own "external" dependencies. \nTrace: package "'+a.location+'" inside package"'+b+'" has "external": '+a.external);return!0}function j(a){if(a in G)return G[a];if(a in F)return F[a]!==!1?G[F[a]]:!1;var b,c;if((b=O.findClosestParent(a))!==!1){for(;b&&b.packages;)c=b,b=k(a,c.packages,c.location);return b=b||c,F[a]=b.location,b}return(b=k(a,H))?b:(F[a]=!1,!1)}function k(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];if(l(a,e,c))return j(a)}return!1}function l(a,b,c){for(var d,e="",f=0,g=x(a,c).split("/"),i=0;i<g.length;i++)e+=(i>0?"/":"")+g[i],q(e,b.location)&&(d=E(b),d.location=B(c,e),h(d,c),F[a]=d.location,++f);return f>0}function m(a){return a?y(a)?a.location:a:""}function n(a,b){return"string"==typeof m(a)&&"string"==typeof m(b)}function o(){for(var a=[],b=[].slice.call(arguments),c=0;c<b.length;c++){var d=m(b[c]);""!==d&&a.push(d)}return a}function p(a,b){if(a=m(a),b=m(b),n(a,b))return B(a,b);var c=o(a,b);return 1===c.length?c[0]:function(a){return q(a,c[0])&&q(a,c[1])}}function q(a,b){if(!b)return!1;if(y(b)&&(b=b.location),"string"==typeof b)return a===b;if(b.constructor===RegExp)return b.test(a);if("function"==typeof b)return b(a);if(b.constructor===Array){for(var c=0;c<b.length;c++)if(q(a,b[c]))return!0;return!1}throw new Error("Pattern should be either string, regexp, function or array")}function r(a,b,c){return a===b?!1:(a=m(a),b=m(b),c?I[b]===a:0===b.indexOf(a))}function s(a,b){return O.findClosestParent(a.location)===O.findClosestParent(b.location)}function t(a){var b=m(a);return b in I&&""!==I[b]}function u(a,b){return a===b.location||r(b,a,!0)&&a.slice(-b.main.length)===b.main}function v(a,b,c){return q(x(b,c),c[a])}function w(a){return B(a.location,a.main)}function x(a,b){var c=m(b).length;return 0===c?a:a.slice(c+1)}function y(a){return"object"==typeof a&&a.constructor===Object}function z(a){return a.replace(/^\/+|\/+$/g,"")}function A(a){return a.split("/").length}function B(){for(var a,b="",c=-1,d=[].slice.call(arguments);++c<d.length;)a=d[c],null!=a&&(b+=a+"/");return z(b)}function C(a){for(var b=[].slice.call(arguments,1),c=0;c<b.length;c++){var d=b[c];for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];a.hasOwnProperty(e)?y(a[e])&&C(a[e],f):a[e]=y(f)?E(f):f}}return a}function D(a){for(var b=[].slice.call(arguments,1),c=0;c<b.length;c++){var d=b[c];for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];y(f)&&y(a[e])?D(a[e],f):a[e]=y(f)?E(f):f}}return a}function E(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b[c]=d.constructor===Array?d.slice():y(d)?E(d):d}return b}var F={},G={},H=[],I={},J={packageDefaults:{main:"index","public":!1,external:!1,packages:!1,"protected":!1,inheritable:{main:!1,"public":!1,packages:!1,"protected":!1,inheritable:!0}},allowRemoteProtected:!1},K=["**root**"],L=!1,M=!1;if(b.packages={init:function(a){if(L)throw new Error("Packages list already initialized");return L=!0,M=!0,H=f(a),!0},configure:function(a){if(M)throw new Error("Packages options already configured, or packages structure is already initialized");M=!0,D(J,a)}},"packages"in a)throw new Error("Can't apply 'require-packages' plugin: current 'require' function already has 'packages' property");for(var N in a)b[N]=a[N];var O=function(){function a(a){for(var b=0;b<d.length-1;b++)if(a>d[b]&&a<d[b+1])return b;return-1}function b(b){var c=A(b);if(!(c in e)){var f=a(c);d.splice(f+1,0,c);var g=e[d[f]];e[c]=null!=g?g:-1}return e[c]}var c=[],d=[-1/0,1/0],e={};return{insertPackage:function(a){var d=a.location;c.splice(b(d)+1,0,d);var f=A(d);for(var g in e)g>=f&&++e[g]},findClosestParent:function(a){if(0===c.length)return!1;for(var d=b(a);d>=0;d--)if(r(c[d],a))return I[a]=c[d],G[c[d]];return!1},findFarthestParent:function(a){if(0===c.length)return!1;for(var b=0;b<c.length;b++)if(r(c[b],a))return G[c[b]];return!1}}}();return b}a.require=b(a.require)};