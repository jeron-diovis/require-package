module.exports=function(a){function b(a){function b(b){var d=J[J.length-1];c(b,d);var e,f=j(b);f!==!1&&b===f.location&&(b=v(f)),J.push(b);try{e=a(b)}finally{J.pop()}return e}function c(a,b){var c=j(b),f=j(a),g=!1;if(c===!1?e(a)||(g="Access to package internal files from outside of package"):d(a,c)||(g=f===!1?"Access to out-of-package files from inside packages":"Cross-package access"),g)throw g+=' is denied!\nAttempt to access "'+a+'" from "'+b+'"',new Error(g);return!0}function d(a,b){var c=j(a);return c===!1?q(a,(s(b)?N.findFarthestParent(b):b).external):c===b||r(b,c,!0)&&(t(a,c)||u("public",a,c))||r(c,b,I.allowRemoteProtected)&&!t(a,b)&&u("protected",a,c)}function e(a){var b=j(a);return b===!1?!0:!s(b)&&(t(a,b)||u("public",a,b))}function f(a,b){var c,d;a=a.constructor!==Array?[a]:a.slice();for(var e=0;e<a.length;){d=a[e],c=x(d)?d:{location:d},b&&g(c,b),B(c,I.packageDefaults);var i=c.location;c.location=p(b,c),n(c.location)?(h(c,b),a.splice(e,1)):(c.location=i,a[e]=c,++e),c.packages&&(c.packages=f(c.packages,c),0===c.packages.length&&(c.packages=!1))}return a}function g(a,b){var c={};for(var d in b.inheritable)b.inheritable[d]===!0&&(c[d]=b[d]);return B(a,c),a}function h(a,b){var c=y(m(b));i(a,c),N.insertPackage(a);var d=v(a);return F[a.location]=a,E[a.location]=a.location,E[d]=a.location,H[d]=a.location,H[a.location]=c,a}function i(a,b){var c=b.length>0;if(c&&a.external)throw new Error('Nested packages can\'t have own "external" dependencies. \nTrace: package "'+a.location+'" inside package"'+b+'" has "external": '+a.external);return!0}function j(a){if(a in F)return F[a];if(a in E)return E[a]!==!1?F[E[a]]:!1;var b,c;if((b=N.findClosestParent(a))!==!1){for(;b&&b.packages;)c=b,b=k(a,c.packages,c.location);return b=b||c,E[a]=b.location,b}return(b=k(a,G))?b:(E[a]=!1,!1)}function k(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];if(l(a,e,c))return j(a)}return!1}function l(a,b,c){for(var d,e="",f=0,g=w(a,c).split("/"),i=0;i<g.length;i++)e+=(i>0?"/":"")+g[i],q(e,b.location)&&(d=D(b),d.location=A(c,e),h(d,c),E[a]=d.location,++f);return f>0}function m(a){return a?x(a)?a.location:a:""}function n(a,b){return"string"==typeof m(a)&&"string"==typeof m(b)}function o(){for(var a=[],b=[].slice.call(arguments),c=0;c<b.length;c++){var d=m(b[c]);""!==d&&a.push(d)}return a}function p(a,b){if(a=m(a),b=m(b),n(a,b))return A(a,b);var c=o(a,b);return 1===c.length?c[0]:function(a){return q(a,c[0])&&q(a,c[1])}}function q(a,b){if(!b)return!1;if(x(b)&&(b=b.location),"string"==typeof b)return a===b;if(b.constructor===RegExp)return b.test(a);if("function"==typeof b)return b(a);if(b.constructor===Array){for(var c=0;c<b.length;c++)if(q(a,b[c]))return!0;return!1}throw new Error("Pattern should be either string, regexp, function or array")}function r(a,b,c){return a===b?!1:(a=m(a),b=m(b),c?H[b]===a:0===b.indexOf(a))}function s(a){var b=m(a);return b in H&&""!==H[b]}function t(a,b){return a===b.location||r(b,a,!0)&&a.slice(-b.main.length)===b.main}function u(a,b,c){return q(w(b,c),c[a])}function v(a){return A(a.location,a.main)}function w(a,b){var c=m(b).length;return 0===c?a:a.slice(c+1)}function x(a){return"object"==typeof a&&a.constructor===Object}function y(a){return a.replace(/^\/+|\/+$/g,"")}function z(a){return a.split("/").length}function A(){for(var a,b="",c=-1,d=[].slice.call(arguments);++c<d.length;)a=d[c],null!=a&&(b+=a+"/");return y(b)}function B(a){for(var b=[].slice.call(arguments,1),c=0;c<b.length;c++){var d=b[c];for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];a.hasOwnProperty(e)?x(a[e])&&B(a[e],f):a[e]=x(f)?D(f):f}}return a}function C(a){for(var b=[].slice.call(arguments,1),c=0;c<b.length;c++){var d=b[c];for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];x(f)&&x(a[e])?C(a[e],f):a[e]=x(f)?D(f):f}}return a}function D(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b[c]=d.constructor===Array?d.slice():x(d)?D(d):d}return b}var E={},F={},G=[],H={},I={packageDefaults:{main:"index","public":!1,external:!1,packages:!1,"protected":!1,inheritable:{main:!1,"public":!1,packages:!1,"protected":!1,inheritable:!0}},allowRemoteProtected:!1},J=["**root**"],K=!1,L=!1;if(b.packages={init:function(a){if(K)throw new Error("Packages list already initialized");return K=!0,G=f(a),!0},configure:function(a){if(L)throw new Error("Packages options already configured");L=!0,C(I,a)}},"packages"in a)throw new Error("Can't apply 'require-packages' plugin: current 'require' function already has 'packages' property");for(var M in a)b[M]=a[M];var N=function(){function a(a){for(var b=0;b<d.length-1;b++)if(a>d[b]&&a<d[b+1])return b;return-1}function b(b){var c=z(b);if(!(c in e)){var f=a(c);d.splice(f+1,0,c);var g=e[d[f]];e[c]=null!=g?g:-1}return e[c]}var c=[],d=[-1/0,1/0],e={};return{insertPackage:function(a){var d=a.location;c.splice(b(d)+1,0,d);var f=z(d);for(var g in e)g>=f&&++e[g]},findClosestParent:function(a){if(0===c.length)return!1;for(var d=b(a);d>=0;d--)if(r(c[d],a))return H[a]=c[d],F[c[d]];return!1},findFarthestParent:function(a){if(0===c.length)return!1;for(var b=0;b<c.length;b++)if(r(c[b],a))return F[c[b]];return!1}}}();return b}a.require=b(a.require)};